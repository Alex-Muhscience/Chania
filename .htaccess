# Enable URL rewriting
RewriteEngine On

# Set default charset
AddDefaultCharset UTF-8

# Prevent directory listing
Options -Indexes

# Custom 404 error page
ErrorDocument 404 /chania/404.php

# Simple approach: rewrite everything to client/public/
# Root access goes to client/public/index.php
RewriteRule ^$ client/public/index.php [L]

# Handle specific files/directories in root that should not be redirected
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(404\.php|admin/.*|api/.*|public/.*|shared/.*)$ - [L]

# All other requests go to client/public/ directory
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ client/public/$1 [L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options SAMEORIGIN
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Prevent access to sensitive files
<FilesMatch "(\\.env|\\.htaccess|composer\\.json|composer\\.lock)">
    Require all denied
</FilesMatch>

# Prevent access to include files
<Files ~ "config\\.php$">
    Order allow,deny
    Deny from all
</Files>
